%{
play.test.Fixtures.deleteAllModels();
play.test.Fixtures.load("../conf/initial-data-prod.yml");
}%
#{selenium 'Log in'}
    clearSession()
    open('/')
    assertTitle('Login')
    type('id=username', 'admin@danutech.com')
    type('id=password', 'hello')
    clickAndWait('id=signin')
    assertTitle('Incidents')
#{/selenium}

#{selenium 'Test creating an account successfully'}
    clickAndWait('link=Admin')
    click('link=Create')
    waitForVisible('id=create')
    assertVisible('id=create')
    type('name=account.key', 'TEST')
    type('name=account.name', 'Testing')
    click('css=b')
    mouseDown('//*[@id="s2id1"]/a/div/b')
    mouseUp('//li[contains(@class,"select2-result")][1]')
    click('id=createBtn')
    waitForNotVisible('id=create')
	assertNotVisible('id=create')
#{/selenium}

#{selenium 'Test editing an account successfully'}
    pause(1000)
    click('//*[@id="accounts"]/tbody/tr/td[5]/div/a[1]')
    waitForVisible('id=create')
    assertVisible('id=create')
    type('name=account.name', 'Test Inc')
    click('css=abbr.select2-search-choice-close')
    click('css=b')
    type('name=account.contact', 'a@test.com')
    click('id=createBtn')
    waitForNotVisible('id=create')
	assertNotVisible('id=create')
#{/selenium}

#{selenium 'Test deleting an account successfully'}
	pause(1000)
    click('//*[@id="accounts"]/tbody/tr/td[5]/div/a[2]')
    waitForVisible('id=delete')
    assertVisible('id=delete')
    click('css=#delete > div.modal-footer > button.btn.btn-danger')
    waitForNotVisible('id=delete')
	assertNotVisible('id=delete')
#{/selenium}

#{selenium 'Test error received when creating an account with a bad key, and then correcting it successfully'}
    pause(1000)
    click('link=Create')
    waitForVisible('id=create')
    assertVisible('id=create')
    type('name=account.key', 'TE')
    type('name=account.name', 'Testing')
    click('css=b')
    mouseDown('//*[@id="s2id1"]/a/div/b')
    mouseUp('//li[contains(@class,"select2-result")][1]')
    click('id=createBtn')
    assertVisible('id=create')
    assertTextPresent('Key must contain at least 4 characters')
    type('name=account.key', 'TEXT')
    click('id=createBtn')
    waitForNotVisible('id=create')
	assertNotVisible('id=create')
#{/selenium}

#{selenium 'Test error received when creating an account with a bad key, then trying an existing key, and then correcting it successfully'}
    pause(1000)
    click('link=Create')
    waitForVisible('id=create')
    assertVisible('id=create')
    type('name=account.key', 'TE')
    type('name=account.name', 'Testing 2')
    click('css=b')
    mouseDown('//*[@id="s2id1"]/a/div/b')
    mouseUp('//li[contains(@class,"select2-result")][1]')
    click('id=createBtn')
    assertVisible('id=create')
    assertTextPresent('Key must contain at least 4 characters')
    type('name=account.key', 'TEST')
    <!--click('id=createBtn')-->
    <!--assertVisible('id=create')-->
    <!--assertTextPresent('That key is already in use')-->
    <!--type('name=account.key', 'TEFT')-->
    <!--click('id=createBtn')-->
    <!--waitForNotVisible('id=create')-->
	<!--assertNotVisible('id=create')-->
#{/selenium}

// TODO Test I can't delete DANU Account
